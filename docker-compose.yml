version: "3"
services:
  ## PACKAGES

  gateway:
    build: .
    env_file:
      - .env
    command: yarn gateway dev
    ports:
      - $GATEWAY_PORT:$GATEWAY_PORT
    volumes:
      - ./packages/gateway:/instapod/packages/gateway
    environment:
      - PORT=$GATEWAY_PORT
      - WEB_PORT=$WEB_PORT
      - API_PORT=$API_PORT
      - AUTHENTICATION_PORT=$AUTHENTICATION_PORT
    working_dir: /instapod
  api:
    build: .
    env_file:
      - .env
    command: yarn api dev
    volumes:
      - ./packages/api:/instapod/packages/api
    environment:
      - PORT=$API_PORT
    working_dir: /instapod
  authentication:
    build: .
    env_file:
      - .env
    command: yarn authentication dev
    volumes:
      - ./packages/authentication:/instapod/packages/authentication
    environment:
      - PORT=$authentication_PORT
    working_dir: /instapod
  web:
    build: .
    env_file:
      - .env
    command: yarn web dev
    ports:
      - $WEB_PORT:$WEB_PORT
    volumes:
      - ./packages/web:/instapod/packages/web
    working_dir: /instapod

  ## DATABASES

  database_authentication:
    image: mongo:latest
    environment:
      - MONGO_INITDB_ROOT_USERNAME=olaven
      - MONGO_INITDB_ROOT_PASSWORD=password

  database_api:
    image: mongo:latest
    environment:
      - MONGO_INITDB_ROOT_USERNAME=olaven
      - MONGO_INITDB_ROOT_PASSWORD=password
